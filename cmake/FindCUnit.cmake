if(NOT PKG_CONFIG_FOUND)
    include(CMakeFindDependencyMacro)
    find_dependency(PkgConfig)
endif()

pkg_check_modules(CUNIT REQUIRED CUnit)

# Look for CUNIT include dir and libraries
IF (NOT CUNIT_FOUND)
    IF (CUNIT_INSTALL_DIR)
        MESSAGE(STATUS "Using override CUNIT_INSTALL_DIR to find CUnit")
        SET(CUNIT_INCLUDE_DIR "${CUNIT_INSTALL_DIR}/include")
        SET(CUNIT_INCLUDE_DIRS "${CUNIT_INCLUDE_DIR}")
        FIND_LIBRARY(CUNIT_LIBRARY NAMES libcunit PATHS "${CUNIT_INSTALL_DIR}/lib")
        # FIND_LIBRARY(COMPAT_LIBRARY NAMES compat PATHS "${CUNIT_INSTALL_DIR}/lib")
        SET(CUNIT_LIBRARIES "${CUNIT_LIBRARY}")
    ELSE (CUNIT_INSTALL_DIR)
        FIND_PATH(CUNIT_INCLUDE_DIR CUnit/CUnit.h)
        FIND_LIBRARY(CUNIT_LIBRARIES NAMES libcunit)
    ENDIF (CUNIT_INSTALL_DIR)

    IF (CUNIT_INCLUDE_DIR AND CUNIT_LIBRARIES)
        SET(CUNIT_FOUND 1)
        IF (NOT CUnit_FIND_QUIETLY)
            MESSAGE(STATUS "Found CUNIT: ${CUNIT_LIBRARIES}")
        ENDIF (NOT CUnit_FIND_QUIETLY)
    ELSE (CUNIT_INCLUDE_DIR AND CUNIT_LIBRARIES)
        IF (CUnit_FIND_REQUIRED)
            MESSAGE(FATAL_ERROR "Could NOT find CUNIT")
        ELSE (CUnit_FIND_REQUIRED)
            IF (NOT CUnit_FIND_QUIETLY)
                MESSAGE(STATUS "Could NOT find CUNIT")
            ENDIF (NOT CUnit_FIND_QUIETLY)
        ENDIF (CUnit_FIND_REQUIRED)
    ENDIF (CUNIT_INCLUDE_DIR AND CUNIT_LIBRARIES)
ENDIF (NOT CUNIT_FOUND)

message("CUNIT_LIBRARIES ${CUNIT_LIBRARIES}")
# Hide advanced variables from CMake GUIs
MARK_AS_ADVANCED(CUNIT_INCLUDE_DIR CUNIT_LIBRARIES)